{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///E:/department-portal-2/app/api/users/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport fs from \"fs\"\r\nimport path from \"path\"\r\n\r\nconst USERS_FILE = path.join(process.cwd(), \"public\", \"staff-users.json\")\r\n\r\ninterface StaffUser {\r\n    id: string\r\n    username: string\r\n    password: string\r\n    name: string\r\n    role: \"admin\" | \"hod\" | \"placement\" | \"faculty\"\r\n    department?: string\r\n    email?: string\r\n}\r\n\r\n// Helper to read users from file\r\nfunction readUsers(): StaffUser[] {\r\n    try {\r\n        if (!fs.existsSync(USERS_FILE)) {\r\n            // Create file with demo users if it doesn't exist\r\n            const demoUsers: StaffUser[] = [\r\n                {\r\n                    id: \"admin-demo\",\r\n                    username: \"admin@example.com\",\r\n                    password: \"admin123\",\r\n                    name: \"System Admin\",\r\n                    role: \"admin\",\r\n                    email: \"admin@example.com\",\r\n                    department: \"\"\r\n                }\r\n            ]\r\n            fs.writeFileSync(USERS_FILE, JSON.stringify(demoUsers, null, 2))\r\n            return demoUsers\r\n        }\r\n        const data = fs.readFileSync(USERS_FILE, \"utf-8\")\r\n        return JSON.parse(data)\r\n    } catch (error) {\r\n        console.error(\"Error reading users file:\", error)\r\n        return []\r\n    }\r\n}\r\n\r\n// Helper to write users to file\r\nfunction writeUsers(users: StaffUser[]): boolean {\r\n    try {\r\n        fs.writeFileSync(USERS_FILE, JSON.stringify(users, null, 2))\r\n        return true\r\n    } catch (error) {\r\n        console.error(\"Error writing users file:\", error)\r\n        return false\r\n    }\r\n}\r\n\r\n// GET - Fetch all users (without passwords for security)\r\nexport async function GET() {\r\n    try {\r\n        const users = readUsers()\r\n        // Remove passwords from response\r\n        const safeUsers = users.map(({ password, ...user }) => user)\r\n        return NextResponse.json(safeUsers)\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to fetch users\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// POST - Add a new user\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json()\r\n        const { username, password, name, role, department, email } = body\r\n\r\n        if (!username || !password || !name || !role) {\r\n            return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 })\r\n        }\r\n\r\n        const users = readUsers()\r\n\r\n        // Check if username already exists\r\n        if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {\r\n            return NextResponse.json({ error: \"Username already exists\" }, { status: 409 })\r\n        }\r\n\r\n        const newUser: StaffUser = {\r\n            id: Date.now().toString(),\r\n            username,\r\n            password,\r\n            name,\r\n            role,\r\n            department: department || \"\",\r\n            email: email || \"\"\r\n        }\r\n\r\n        users.push(newUser)\r\n\r\n        if (writeUsers(users)) {\r\n            // Return user without password\r\n            const { password: _, ...safeUser } = newUser\r\n            return NextResponse.json(safeUser, { status: 201 })\r\n        } else {\r\n            return NextResponse.json({ error: \"Failed to save user\" }, { status: 500 })\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error adding user:\", error)\r\n        return NextResponse.json({ error: \"Failed to add user\" }, { status: 500 })\r\n    }\r\n}\r\n\r\n// DELETE - Remove a user\r\nexport async function DELETE(request: NextRequest) {\r\n    try {\r\n        const { searchParams } = new URL(request.url)\r\n        const id = searchParams.get(\"id\")\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ error: \"User ID required\" }, { status: 400 })\r\n        }\r\n\r\n        const users = readUsers()\r\n        const filteredUsers = users.filter(u => u.id !== id)\r\n\r\n        if (filteredUsers.length === users.length) {\r\n            return NextResponse.json({ error: \"User not found\" }, { status: 404 })\r\n        }\r\n\r\n        if (writeUsers(filteredUsers)) {\r\n            return NextResponse.json({ success: true })\r\n        } else {\r\n            return NextResponse.json({ error: \"Failed to delete user\" }, { status: 500 })\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error deleting user:\", error)\r\n        return NextResponse.json({ error: \"Failed to delete user\" }, { status: 500 })\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}